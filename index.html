<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu des images !! </title>
    <style>
        
        
        /* --- Variables CSS (facilite les changements de couleurs) --- */
:root {
    --primary-color: #61dafb; /* Bleu clair, vif */
    --secondary-color: #f2c75c; /* Jaune/orange pour accents et mises en évidence */
    --dark-bg: #282c34; /* Arrière-plan sombre (presque noir) */
    --light-text: #ffffff; /* Texte blanc */
    --gray-text: #a0a0a0; /* Texte gris clair pour infos secondaires */
    --success-color: #4CAF50; /* Vert pour le succès */
    --error-color: #f44336; /* Rouge pour les erreurs/boutons d'action */
    --border-color: #444; /* Couleur de bordure subtile */
    --button-hover-darken: #4cb8e0; /* Couleur au survol des boutons primaires */
    --shadow-light: rgba(0, 0, 0, 0.2);
    --shadow-medium: rgba(0, 0, 0, 0.4);
}

/* --- Styles Généraux --- */
body {
    font-family: 'Poppins', sans-serif; /* Proposer une police moderne */
    background-color: var(--dark-bg);
    color: var(--light-text);
    display: flex;
    justify-content: center; /* Centre le contenu horizontalement */
    align-items: center; /* Centre le contenu verticalement si hauteur suffisante */
    min-height: 100vh; /* Prend toute la hauteur de la fenêtre */
    margin: 0;
    overflow-x: hidden; /* Empêche le défilement horizontal */
    padding: 20px; /* Un peu de padding global */
    box-sizing: border-box; /* Inclure padding dans la largeur/hauteur */
}

h1, h2, h3 {
    color: var(--primary-color);
    text-align: center;
    margin-bottom: 20px;
}

/* --- Conteneurs Principaux --- */
.container { /* Appliquer à ton #lobby-container, #game-container, #final-results-container */
    background-color: #363a43; /* Un gris un peu plus clair que le fond */
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 8px 25px var(--shadow-medium);
    text-align: center;
    width: 100%;
    max-width: 600px; /* Limite la largeur pour une meilleure lisibilité */
    box-sizing: border-box;
    display: none; /* Caché par défaut, géré par JS */
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

.container.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

/* --- Éléments de Formulaire (Inputs et Boutons) --- */
input[type="text"] {
    width: calc(100% - 20px); /* Prend toute la largeur moins le padding */
    padding: 12px 10px;
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background-color: #4a4e58; /* Un gris foncé pour l'input */
    color: var(--light-text);
    font-size: 1em;
    outline: none; /* Supprime le contour bleu au focus */
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

input[type="text"]:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 8px rgba(97, 218, 251, 0.5); /* Ombre lumineuse au focus */
}

button {
    background-color: var(--primary-color);
    color: var(--dark-bg); /* Texte sombre sur bouton clair */
    border: none;
    padding: 12px 25px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    margin: 5px; /* Petit espacement entre les boutons */
    box-shadow: 0 4px 10px var(--shadow-light);
}

button:hover:not(:disabled) {
    background-color: var(--button-hover-darken);
    transform: translateY(-2px); /* Léger effet de soulèvement */
    box-shadow: 0 6px 15px var(--shadow-medium);
}

button:active:not(:disabled) {
    transform: translateY(0); /* Effet d'enfoncement */
    box-shadow: 0 2px 5px var(--shadow-light);
}

button:disabled {
    background-color: #555;
    cursor: not-allowed;
    opacity: 0.7;
}

/* --- Styles spécifiques du Lobby --- */
#lobby-container {
    padding-bottom: 40px; /* Plus d'espace pour la liste des joueurs */
}

#player-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    max-height: 200px;
    overflow-y: auto; /* Scroll si trop de joueurs */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #4a4e58;
}

#player-list li {
    padding: 10px 15px;
    border-bottom: 1px solid #555;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#player-list li:last-child {
    border-bottom: none;
}

/* --- Styles spécifiques du Jeu (Game Container) --- */
#film-image {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 6px 20px var(--shadow-medium);
    margin-bottom: 30px;
    border: 3px solid var(--primary-color); /* Cadre autour de l'image */
}

.timer-display {
    font-size: 1.8em;
    font-weight: bold;
    color: var(--secondary-color); /* Couleur accentuée pour le minuteur */
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.timer-display span {
    font-size: 1.2em; /* Pour le nombre du timer */
    margin-left: 8px;
    color: var(--light-text);
}

/* Styles pour le message de feedback (bonne/mauvaise réponse) */
#feedback-message {
    padding: 12px;
    border-radius: 8px;
    font-weight: bold;
    margin-bottom: 20px;

    /* Garder ces propriétés pour les transitions */
    opacity: 0; 
    transform: translateY(10px);
    transition: opacity 0.4s ease-out, transform 0.4s ease-out, background-color 0.3s ease, color 0.3s ease;
}

/* Nouvelle classe pour l'affichage avec transition */
#feedback-message.show {
    opacity: 1;
    transform: translateY(0);
}
/* Les couleurs ne sont plus gérées par des classes ici, mais par JS */

#feedback-message.correct {
    background-color: var(--success-color);
    color: white;
}

#feedback-message.incorrect {
    background-color: var(--error-color);
    color: white;
}


#next-film-button {
    background-color: var(--secondary-color); /* Couleur différente pour l'action de fin de film */
    color: var(--dark-bg);
}

#next-film-button:hover:not(:disabled) {
    background-color: #e0b44f; /* Assombrir au survol */
}

#skip-image-button {
    background-color: var(--error-color); /* Bouton rouge d'action rapide */
    color: white;
}

#skip-image-button:hover:not(:disabled) {
    background-color: #d32f2f; /* Assombrir au survol */
}


/* --- Styles pour l'affichage du titre du film révélé --- */
#film-reveal-message {
    background-color: var(--success-color);
    color: var(--light-text);
    font-size: 1.8em; /* Plus grand pour l'impact */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    margin-bottom: 30px;
    position: absolute; /* Pour le placer au-dessus des autres éléments */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2000; /* Assure qu'il est au-dessus de tout */
    width: 80%; /* Pour qu'il ne prenne pas toute la largeur */
    max-width: 500px;
    box-sizing: border-box;
}

#revealed-film-title {
    color: var(--light-text); /* Assure que le texte du titre est bien blanc */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* Petite ombre pour lisibilité */
}


/* --- Styles des scores finaux --- */
#final-results-container {
    text-align: center;
}

#final-scores-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    font-size: 1.2em;
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #4a4e58;
}

#final-scores-list li {
    padding: 10px 15px;
    border-bottom: 1px solid #555;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#final-scores-list li:last-child {
    border-bottom: none;
}

#final-scores-list li.winner {
    background-color: rgba(97, 218, 251, 0.2); /* Fond léger pour le gagnant */
    font-weight: bold;
    color: var(--primary-color);
}

/* --- Live Feedback Hôte --- */
#host-live-feedback {
    /* Styles inline déjà définis pour positionnement, mais tu peux ajouter ici pour l'esthétique */
    background-color: rgba(40, 44, 52, 0.9); /* Un peu plus sombre, plus transparent */
    border: 1px solid var(--primary-color);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

#host-live-feedback h3 {
    color: var(--secondary-color);
    font-size: 1.1em;
    margin-top: 0;
    border-bottom: 1px solid #555;
    padding-bottom: 10px;
}

#live-answers-list {
    font-size: 0.9em;
    color: var(--gray-text);
}

#live-answers-list li {
    margin-bottom: 5px;
    word-wrap: break-word; /* Casse les longs mots */
}

/* --- Intégration d'une police Google Fonts (à ajouter dans <head> de index.html) --- */
/*
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
*/
        
        
        
        
        
        
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #282c34;
            color: white;
            margin: 0;
            padding: 20px;
            box-sizing: border-box; /* Pour inclure le padding dans la largeur/hauteur */
        }

        

        #film-image {
    -webkit-user-drag: none; /* Safari, Chrome, Edge */
    -khtml-user-drag: none; /* Konqueror */
    -moz-user-drag: none; /* Firefox */
    -o-user-drag: none; /* Opera */
    pointer-events: none;
    
}



        
        #lobby-container, #game-container {
    /* Ces styles devraient rester les mêmes que ton code précédent */
    background-color: #383c44;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    width: 100%; /* Important pour que ça prenne toute la largeur disponible */
    max-width: 600px; /* Limite la largeur du conteneur principal */
    text-align: center;
    display: none;
}



        /* Styles pour afficher le lobby ou le jeu quand nécessaire */
        #lobby-container.active, #game-container.active {
            display: block;
        }

        h1, h2 {
            color: #61dafb;
        }

        #film-image {
            max-width: 90%; /* Ajusté pour mieux s'adapter */
            height: auto;
            margin-bottom: 20px;
            border: 2px solid #61dafb;
            border-radius: 5px;
        }

        input[type="text"] {
            padding: 10px;
            width: calc(100% - 130px); /* Ajusté pour le bouton */
            margin-right: 10px;
            border: none;
            border-radius: 5px;
            background-color: #444a52;
            color: white;
        }

        button {
            padding: 10px 20px;
            background-color: #61dafb;
            color: #282c34;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #4fa3d1;
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #player-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #61dafb;
            border-radius: 5px;
            background-color: #2e323a;
            text-align: left; /* Pseudos alignés à gauche */
        }

        #player-list li {
            padding: 8px 15px;
            border-bottom: 1px solid #383c44;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #player-list li:last-child {
            border-bottom: none;
        }

        #lobby-input-area {
            margin-bottom: 20px;
        }

        #start-game-button {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 1.2em;
        }

        .timer-display {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #FFD700; /* Or Jaune pour le minuteur */
        }

        #score-display {
            margin-bottom: 20px;
            border: 1px solid #61dafb;
            border-radius: 5px;
            padding: 10px;
            background-color: #2e323a;
        }
        #score-display h2 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #61dafb;
        }
        #score-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        #score-list li {
            padding: 5px 0;
            border-bottom: 1px dashed #444a52;
        }
        #score-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    
    
    <div id="lobby-container" class="active">
        <h1>Rejoins la partie !</h1>
        <div id="lobby-input-area">
            <input type="text" id="pseudo-input" placeholder="Choisis ton pseudo">
            <button id="join-lobby-button">Rejoindre</button>
        </div>
        <h2>Joueurs connectés :</h2>
        <ul id="player-list">
            </ul>
        <button id="start-game-button" style="display: none;">Lancer la partie</button>
    </div>

    <div id="game-container">
        <h1>D'ou vient cette image</h1>
        <img id="film-image" src="https://via.placeholder.com/400x250?text=Attente+Image" alt="Image du film" oncontextmenu="return false;" draggable="false">
        <p class="timer-display">Minuteur: <span id="timer">30</span>s</p>

         <div id="feedback-message" style="
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            display: none; /* Caché par défaut */
        "></div>
       
    <div id="film-reveal-message" style="
        display: none; /* Caché par défaut */
        margin-top: 20px;
        padding: 15px;
        background-color: #4CAF50; /* Couleur verte pour "correct" */
        color: white;
        font-size: 1.5em;
        font-weight: bold;
        border-radius: 8px;
        text-align: center;
        opacity: 0; /* Pour l'animation de fondu */
        transition: opacity 0.5s ease-in-out; /* Transition pour l'opacité */
    ">
        Réponse : <span id="revealed-film-title"></span>
    </div>   
       
       
      
       
        <input type="text" id="answer-input" placeholder="Tape ta réponse ici">
        <button id="submit-button">Envoyer</button>
        <button id="next-film-button" style="display: none; margin-top: 20px; background-color: var(--secondary-color); color: var(--dark-bg);">Passer au film suivant</button>
        <button id="skip-image-button" style="display: none; margin-top: 20px; background-color: #f44336; color: white;">Passer l'image</button>
    </div>


<div id="game-container">
        </div>

    <div id="final-results-container" style="display: none;">
        <h1>Fin de la partie !</h1>
        <h2>Classement final :</h2>
        <ul id="final-score-list">
            </ul>
        <button id="restart-game-button" style="margin-top: 20px;">Rejouer</button>
    </div>

    <div id="host-live-feedback" style="
        display: none; /* Caché par défaut */
        position: fixed; /* Position fixe pour qu'il ne bouge pas en scrollant */
        bottom: 20px; /* 20px du bas de la fenêtre */
        right: 20px; /* 20px de la droite de la fenêtre */
        width: 300px; /* Largeur du panneau */
        max-height: 40vh; /* Hauteur maximale pour éviter qu'il ne soit trop grand */
        background-color: rgba(56, 60, 68, 0.9); /* Fond semi-transparent */
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        padding: 15px;
        color: white;
        z-index: 1000; /* Assure qu'il est au-dessus des autres éléments */
        overflow-y: auto; /* Ajoute une barre de défilement si le contenu dépasse */
        border: 1px solid #61dafb;
    ">
        <h3>Réponses en direct (Hôte seulement)</h3>
        <ul id="live-answers-list" style="list-style: none; padding: 0; margin: 0;">
            </ul>
    </div>


    <body>
    <audio id="soundCorrect" src="/sounds/correct_answer.wav" preload="auto" volume="0.4"></audio>
    <audio id="soundWrong" src="/sounds/wrong_answer.mp3" preload="auto" volume="0.4"></audio>
    <div id="lobby-container" class="active">
    
    <script src="/socket.io/socket.io.js"></script>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();

        // --- Éléments du DOM ---
        const lobbyContainer = document.getElementById('lobby-container');
        const gameContainer = document.getElementById('game-container');
        const pseudoInput = document.getElementById('pseudo-input');
        const joinLobbyButton = document.getElementById('join-lobby-button');
        const feedbackMessageElement = document.getElementById('feedback-message');
        const playerList = document.getElementById('player-list');
        const startGameButton = document.getElementById('start-game-button');
        const nextFilmButton = document.getElementById('next-film-button'); // RÉINTRODUCTION
        const finalResultsContainer = document.getElementById('final-results-container');
        const hostLiveFeedback = document.getElementById('host-live-feedback');
        const skipImageButton = document.getElementById('skip-image-button'); // NOUVEAU
        const filmRevealMessage = document.getElementById('film-reveal-message'); // NOUVEAU
const revealedFilmTitleSpan = document.getElementById('revealed-film-title'); // NOUVEAU
const liveAnswersList = document.getElementById('live-answers-list');
const finalScoreList = document.getElementById('final-score-list');
const restartGameButton = document.getElementById('restart-game-button');

        const filmImage = document.getElementById('film-image'); // Pour l'image du film
        filmImage.addEventListener('contextmenu', (e) => {
    e.preventDefault(); // Empêche l'affichage du menu contextuel
    // Optionnel: tu peux ajouter un petit message pour l'utilisateur
    // console.log("Le clic droit est désactivé sur l'image pour éviter la triche !");
});
        const timerElement = document.getElementById('timer');
        const answerInput = document.getElementById('answer-input');
        const submitButton = document.getElementById('submit-button');

        // Audio elements
const soundCorrect = document.getElementById('soundCorrect');
const soundWrong = document.getElementById('soundWrong');

// Fonction utilitaire pour jouer un son (gère la politique d'autoplay des navigateurs)
function playSound(audioElement) {
    if (audioElement) {
        audioElement.currentTime = 0; // Rembobine le son au début
        const playPromise = audioElement.play();

        if (playPromise !== undefined) {
            playPromise.then(_ => {
                // Lecture réussie
            })
            .catch(error => {
                // La lecture a été bloquée (par exemple, par la politique d'autoplay)
                console.warn("La lecture audio a été bloquée :", error);
                // Tu peux éventuellement afficher un message à l'utilisateur ici
                // "Clique n'importe où pour activer le son"
            });
        }
    }
}

// Bloquer le clic droit sur toute la page pour tenter d'empêcher l'inspection
document.addEventListener('contextmenu', (e) => {
    e.preventDefault(); // Empêche le menu contextuel par défaut d'apparaître
    console.log("Le clic droit est désactivé sur cette page pour des raisons de jeu anti-triche.");
    // Vous pouvez ajouter un message visuel ici si vous le souhaitez
    // alert("Le clic droit est désactivé.");
});

        // NOUVEL AJOUT : Écouteur pour cacher le bouton "Passer au film suivant" (peut être appelé par le serveur)
socket.on('hide next film button', () => {
    nextFilmButton.style.display = 'none';
    console.log("Hôte : Bouton 'Passer au film suivant' masqué par le serveur.");
});

// NOUVEL AJOUT : Révéler le titre du film
socket.on('reveal film', (filmTitle) => {
    revealedFilmTitleSpan.textContent = filmTitle;
    filmRevealMessage.style.display = 'block'; // Afficher le conteneur
    setTimeout(() => { // Petite animation de fondu
        filmRevealMessage.style.opacity = 1;
    }, 10); // Petit délai pour que la transition s'active

    // Masquer le champ de réponse et le bouton d'envoi pendant la révélation
    answerInput.style.display = 'none';
    submitButton.style.display = 'none';
    skipImageButton.style.display = 'none'; // Cacher le bouton "Passer l'image" aussi

    setTimeout(() => {
        filmRevealMessage.style.opacity = 0;
        setTimeout(() => {
            filmRevealMessage.style.display = 'none';
            // answerInput.disabled = false; // Ne pas réactiver ici, l'hôte doit cliquer
            // submitButton.disabled = false; // Ne pas réactiver ici

            // NOUVELLE LOGIQUE : Afficher le bouton "Passer au film suivant" si c'est l'hôte
            if (isHost) {
                nextFilmButton.style.display = 'block';
            }
            // Le bouton "Passer l'image" ne doit être réactivé qu'au prochain film/image,
            // quand sendCurrentImageAndStartTimer est appelé.
            // Donc, ne pas le réafficher ici.

        }, 500); // Attendre la fin de la transition (0.5s)
    }, 3000); // Afficher pendant 3 secondes
});


// NOUVEL AJOUT : Écouteur pour le bouton "Passer l'image"
skipImageButton.addEventListener('click', () => {
    if (isHost) { // S'assurer que seul l'hôte peut envoyer ce signal
        socket.emit('skip current image');
        console.log("Hôte a demandé de passer l'image.");
    }
});

socket.on('game started', () => {
    lobbyContainer.classList.remove('active');
    gameContainer.classList.add('active');
    console.log("La partie a commencé !");

    if (isHost) { // Si c'est l'hôte
        hostLiveFeedback.style.display = 'block'; // Rendre le panneau visible
        liveAnswersList.innerHTML = ''; // Nettoyer la liste à chaque début de partie
         skipImageButton.style.display = 'block'; // NOUVEL AJOUT : Afficher le bouton pour l'hôte
        
    }
});



// NOUVEL AJOUT : Écouteur pour revenir au lobby (appelé par le serveur après un redémarrage)
socket.on('return to lobby', () => {
    finalResultsContainer.style.display = 'none'; // Cache l'écran des résultats si visible
    gameContainer.classList.remove('active'); // Cache le jeu si visible
    lobbyContainer.classList.add('active'); // Affiche le lobby
    hostLiveFeedback.style.display = 'none'; // Masquer le live feedback
    skipImageButton.style.display = 'none'; // NOUVEL AJOUT : Masquer le bouton


    // Réinitialise l'input du pseudo et les boutons si besoin
    const lobbyInputArea = document.getElementById('lobby-input-area');
    // Vérifie si l'input pseudo est toujours présent ou si un message de bienvenue est là
    if (!document.getElementById('pseudo-input')) {
        lobbyInputArea.innerHTML = `
            <input type="text" id="pseudo-input" placeholder="Choisis ton pseudo">
            <button id="join-lobby-button">Rejoindre</button>
        `;
        const newPseudoInput = document.getElementById('pseudo-input');
        const newJoinLobbyButton = document.getElementById('join-lobby-button');
        // Ré-attacher l'écouteur de clic pour le nouveau bouton "Rejoindre"
        newJoinLobbyButton.addEventListener('click', () => {
            const pseudo = newPseudoInput.value.trim();
            if (pseudo) {
                currentPlayerPseudo = pseudo;
                socket.emit('set pseudo', pseudo);
            } else {
                alert('Veuillez entrer un pseudo !');
            }
        });
    }

    // S'assurer que le bouton de démarrage de jeu est visible pour l'hôte
    if (isHost) {
        startGameButton.style.display = 'block';
    } else {
        startGameButton.style.display = 'none';
    }
    console.log("Retour au lobby.");
});
        // Écouteur pour afficher le bouton "Passer au film suivant" (pour l'hôte)
socket.on('show next film button', () => {
    if (isHost) { // S'assure que seul l'hôte voit le bouton
        nextFilmButton.style.display = 'block'; // Rend le bouton visible
        console.log("Hôte : Bouton 'Passer au film suivant' affiché.");
    }
});

// Écouteur pour les réponses en direct (Hôte seulement)
socket.on('live answer', (data) => {
    if (isHost) { // S'assurer que seul l'hôte reçoit et affiche
        const li = document.createElement('li');
        li.textContent = `${data.pseudo}: ${data.answer}`;
        // Optionnel: ajouter un style différent pour les bonnes/mauvaises réponses si tu veux
        // if (data.correct) { li.style.color = 'lightgreen'; } else { li.style.color = 'orange'; }

        // Ajouter en haut de la liste pour voir les dernières réponses en premier
        liveAnswersList.prepend(li); 

        // NOUVEL AJOUT : Limiter le nombre d'éléments dans la liste
        const maxMessages = 15; // Définis le nombre maximum de messages à afficher (par exemple, 15 ou 20)
        while (liveAnswersList.children.length > maxMessages) {
            liveAnswersList.removeChild(liveAnswersList.lastChild); // Supprime le plus ancien message
        }
    }
});


        // NOUVEL AJOUT : Écouteur pour le bouton "Passer au film suivant"
nextFilmButton.addEventListener('click', () => {
    if (isHost) {
        console.log("Hôte a demandé de passer au film suivant.");
        socket.emit('request next film');
        nextFilmButton.style.display = 'none'; // Masquer le bouton après le clic
    }
});

// NOUVEL AJOUT : Écouteur pour le bouton "Rejouer"
restartGameButton.addEventListener('click', () => {
    if (isHost) {
        socket.emit('host restart game'); // Signal au serveur
        finalResultsContainer.style.display = 'none'; // Cache l'écran des résultats
        // Le serveur va renvoyer au lobby et démarrer une nouvelle partie
    }
});
        
        // Ajout d'un conteneur pour afficher les scores dans l'interface de jeu
        const scoreDisplay = document.createElement('div');
        scoreDisplay.id = 'score-display';
        scoreDisplay.innerHTML = '<h2>Scores:</h2><ul id="score-list"></ul>';
        // Insère l'affichage des scores au début du game-container (avant l'image)
        gameContainer.insertBefore(scoreDisplay, filmImage);


        let currentPlayerPseudo = '';
        let isHost = false;

        // --- Gestion du lobby et connexion ---
        joinLobbyButton.addEventListener('click', () => {
            const pseudo = pseudoInput.value.trim();
            if (pseudo) {
                currentPlayerPseudo = pseudo;
                socket.emit('set pseudo', pseudo);
                // Le serveur confirmera l'acceptation du pseudo ou le rejettera
            } else {
                alert('Veuillez entrer un pseudo !');
            }
        });

        // Écoute l'événement 'pseudo taken' du serveur (pseudo déjà utilisé ou invalide)
        socket.on('pseudo taken', (message) => {
            alert(message);
            pseudoInput.value = ''; // Efface le champ
            pseudoInput.focus(); // Redonne le focus pour resaisir
        });

        // Écoute l'événement 'pseudo accepted' du serveur
        socket.on('pseudo accepted', () => {
            pseudoInput.style.display = 'none';
            joinLobbyButton.style.display = 'none';
            document.getElementById('lobby-input-area').innerHTML = `<p>Bienvenue, ${currentPlayerPseudo} ! En attente des autres joueurs...</p>`;
        });


        // Écoute l'événement 'host connected' du serveur
        socket.on('host connected', () => {
            isHost = true;
            startGameButton.style.display = 'block'; // Affiche le bouton "Lancer la partie" pour l'hôte
            console.log("Tu es l'hôte de la partie.");
        });

        // Écoute l'événement 'update player list' du serveur
        socket.on('update player list', (players) => {
            playerList.innerHTML = ''; // Vide la liste actuelle
            players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player; // Player est juste le pseudo dans cette version
                playerList.appendChild(li);
            });
        });

        // Écoute l'événement 'update scores' du serveur pour afficher les scores des joueurs
        socket.on('update scores', (scores) => {
            const scoreList = document.getElementById('score-list');
            scoreList.innerHTML = '';
            scores.forEach(player => {
                const li = document.createElement('li');
                li.textContent = `${player.pseudo}: ${player.score} points`;
                scoreList.appendChild(li);
            });
        });

        // --- Lancement de la partie (pour l'hôte) ---
        startGameButton.addEventListener('click', () => {
            if (isHost) {
                socket.emit('start game'); // Informe le serveur de lancer la partie
                console.log("L'hôte a lancé la partie !");
            }
        });

    

        // --- Gestion du jeu : affichage image, minuteur, réponses ---

        // Écoute l'événement 'display image' du serveur pour changer l'image
        socket.on('display image', (data) => {
            filmImage.src = data.url; // Change la source de l'image
            console.log(`Nouvelle image affichée: ${data.url}. Points possibles: ${data.points}`);
            // Le minuteur est géré par le serveur, on met juste à jour l'affichage initial
            timerElement.textContent = data.initialTime || '30'; // Affiche le temps initial
            answerInput.value = ''; // Vide le champ de réponse
            answerInput.disabled = false; // Réactive l'input
            submitButton.disabled = false; // Réactive le bouton
            answerInput.focus(); // Met le curseur dans le champ de réponse
           nextFilmButton.style.display = 'none';

    // Réafficher le bouton "Passer l'image" si c'est l'hôte et que le jeu est en cours
    if (isHost) { // Supposons que gameStarted est déjà géré ailleurs
        skipImageButton.style.display = 'block'; 
    }
          
    // NOUVEL AJOUT : Cacher le message de feedback au début d'une nouvelle image
    feedbackMessageElement.style.display = 'none';
    feedbackMessageElement.textContent = ''; 
});

        // Écoute l'événement 'timer update' du serveur pour mettre à jour le minuteur
        socket.on('timer update', (timeLeft) => {
            timerElement.textContent = timeLeft;
        });

        // Écoute l'événement 'timer expired' du serveur quand le temps est écoulé
        socket.on('timer expired', () => {
            timerElement.textContent = "Temps écoulé !";
            answerInput.disabled = true; // Désactive l'input
            submitButton.disabled = true; // Désactive le bouton
            console.log("Temps écoulé pour cette image. En attente de la suite...");
        });

// MODIFIÉ : Gestion du résultat de réponse avec transitions et couleurs JS
socket.on('answer result', (result) => {
    feedbackMessageElement.textContent = result.message;
    feedbackMessageElement.style.display = 'block'; // Rendre le message visible pour la transition

    // Appliquer les couleurs directement via JS, comme tu le faisais
    if (result.correct) {
        playSound(soundCorrect);
        feedbackMessageElement.style.backgroundColor = '#4CAF50'; // Vert pour succès
        feedbackMessageElement.style.color = 'white';
    } else {
        playSound(soundWrong);
        feedbackMessageElement.style.backgroundColor = '#F44336'; // Rouge pour échec
        feedbackMessageElement.style.color = 'white';
    }

    // Ajouter la classe 'show' pour déclencher l'animation d'apparition (opacity et transform)
    setTimeout(() => {
        feedbackMessageElement.classList.add('show');
    }, 10); // Petit délai pour permettre au navigateur d'appliquer display: block avant la transition

    // Désactiver l'input et le bouton de soumission (si tu veux qu'ils soient désactivés pendant le message)
    answerInput.disabled = true;
    submitButton.disabled = true;

    // Cacher le message après quelques secondes avec une transition
    // Le 2000 ms = 2 secondes d'affichage visible
    setTimeout(() => {
        feedbackMessageElement.classList.remove('show'); // Déclencher la transition de masquage
        // Une fois la transition de masquage terminée (0.4s défini dans le CSS)
        setTimeout(() => {
            feedbackMessageElement.style.display = 'none'; // Cacher complètement l'élément
            feedbackMessageElement.textContent = ''; // Effacer le texte
            // Réactiver l'input et le bouton (si le jeu continue)
            // Assurez-vous que c'est le bon endroit pour les réactiver,
            // car si un joueur trouve le film, ils doivent rester désactivés.
            // Cela est généralement géré par la logique du tour (checkRoundEnd/sendCurrentImageAndStartTimer).
            // Pour l'instant, je les remets ici, mais tu pourrais vouloir les gérer différemment.
            answerInput.disabled = false;
            submitButton.disabled = false;
        }, 400); // Durée de la transition d'opacité dans le CSS (0.4s)
    }, 2000); 
});

        // Écoute l'événement 'reset input' du serveur (nouvelle image/manche)
        socket.on('reset input', () => {
            answerInput.value = '';
            answerInput.disabled = false;
            submitButton.disabled = false;
            timerElement.textContent = '30'; // Réinitialise l'affichage du minuteur à 30
            answerInput.focus();
        });

        // MODIFIÉ : Gestion de la fin de partie
socket.on('game over', (finalScores) => {
    console.log("La partie est terminée ! Scores finaux :", finalScores);

    // Masquer le conteneur du jeu
    gameContainer.classList.remove('active');
    // Masquer le bouton "Passer au film suivant" si jamais il était encore visible
    nextFilmButton.style.display = 'none';

    // Afficher le conteneur des résultats finaux
    finalResultsContainer.style.display = 'block';

    hostLiveFeedback.style.display = 'none'; // Masquer le live feedback
    skipImageButton.style.display = 'none'; // NOUVEL AJOUT : Masquer le bouton
    

    // Nettoyer la liste des scores et ajouter les scores finaux
    finalScoreList.innerHTML = '';
    // Trier les scores par ordre décroissant (meilleur score en premier)
    const sortedScores = finalScores.sort((a, b) => b.score - a.score);

    sortedScores.forEach(player => {
        const li = document.createElement('li');
        li.textContent = `${player.pseudo}: ${player.score} points`;
        finalScoreList.appendChild(li);
    });

    // Le bouton "Rejouer" n'est visible que pour l'hôte
    if (isHost) {
        restartGameButton.style.display = 'block';
    } else {
        restartGameButton.style.display = 'none';
    }
    console.log("Écran des résultats finaux affiché.");
});


        // --- Gestion des réponses ---
        submitButton.addEventListener('click', () => {
            const userAnswer = answerInput.value.trim();
            if (userAnswer !== "") {
                console.log(`Tentative de réponse : ${userAnswer}`);
                socket.emit('submit answer', userAnswer);
                // La désactivation du bouton/input est gérée par le serveur via 'answer result'
            } else {
                alert("Veuillez taper une réponse !");
            }
        });

        // Initialisation au chargement de la page : cacher le game-container et afficher le lobby
        document.addEventListener('DOMContentLoaded', () => {
            lobbyContainer.classList.add('active');
            gameContainer.classList.remove('active');
        });
    </script>
</body>
</html>