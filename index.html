<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu des images !! </title>
    <style>
        
        
        /* --- Variables CSS (facilite les changements de couleurs) --- */
:root {
    --primary-color: #61dafb; /* Bleu clair, vif */
    --secondary-color: #f2c75c; /* Jaune/orange pour accents et mises en évidence */
    --dark-bg: #282c34; /* Arrière-plan sombre (presque noir) */
    --light-text: #ffffff; /* Texte blanc */
    --gray-text: #a0a0a0; /* Texte gris clair pour infos secondaires */
    --success-color: #4CAF50; /* Vert pour le succès */
    --error-color: #f44336; /* Rouge pour les erreurs/boutons d'action */
    --border-color: #444; /* Couleur de bordure subtile */
    --button-hover-darken: #4cb8e0; /* Couleur au survol des boutons primaires */
    --shadow-light: rgba(0, 0, 0, 0.2);
    --shadow-medium: rgba(0, 0, 0, 0.4);
}

/* --- Styles Généraux --- */
body {
    font-family: 'Poppins', sans-serif; /* Proposer une police moderne */
    background-color: var(--dark-bg);
    color: var(--light-text);
    display: flex;
    justify-content: center; /* Centre le contenu horizontalement */
    align-items: center; /* Centre le contenu verticalement si hauteur suffisante */
    min-height: 100vh; /* Prend toute la hauteur de la fenêtre */
    margin: 0;
    overflow-x: hidden; /* Empêche le défilement horizontal */
    padding: 20px; /* Un peu de padding global */
    box-sizing: border-box; /* Inclure padding dans la largeur/hauteur */
}

h1, h2, h3 {
    color: var(--primary-color);
    text-align: center;
    margin-bottom: 20px;
}

/* --- Conteneurs Principaux --- */
.container { /* Appliquer à ton #lobby-container, #game-container, #final-results-container */
    background-color: #363a43; /* Un gris un peu plus clair que le fond */
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 8px 25px var(--shadow-medium);
    text-align: center;
    width: 100%;
    max-width: 600px; /* Limite la largeur pour une meilleure lisibilité */
    box-sizing: border-box;
    display: none; /* Caché par défaut, géré par JS */
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

.container.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

/* --- Éléments de Formulaire (Inputs et Boutons) --- */
input[type="text"] {
    width: calc(100% - 20px); /* Prend toute la largeur moins le padding */
    padding: 12px 10px;
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background-color: #4a4e58; /* Un gris foncé pour l'input */
    color: var(--light-text);
    font-size: 1em;
    outline: none; /* Supprime le contour bleu au focus */
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

input[type="text"]:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 8px rgba(97, 218, 251, 0.5); /* Ombre lumineuse au focus */
}

button {
    background-color: var(--primary-color);
    color: var(--dark-bg); /* Texte sombre sur bouton clair */
    border: none;
    padding: 12px 25px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    margin: 5px; /* Petit espacement entre les boutons */
    box-shadow: 0 4px 10px var(--shadow-light);
}

button:hover:not(:disabled) {
    background-color: var(--button-hover-darken);
    transform: translateY(-2px); /* Léger effet de soulèvement */
    box-shadow: 0 6px 15px var(--shadow-medium);
}

button:active:not(:disabled) {
    transform: translateY(0); /* Effet d'enfoncement */
    box-shadow: 0 2px 5px var(--shadow-light);
}

button:disabled {
    background-color: #555;
    cursor: not-allowed;
    opacity: 0.7;
}

/* --- Styles spécifiques du Lobby --- */
#lobby-container {
    padding-bottom: 40px; /* Plus d'espace pour la liste des joueurs */
}

#player-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    max-height: 200px;
    overflow-y: auto; /* Scroll si trop de joueurs */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #4a4e58;
}

#player-list li {
    padding: 10px 15px;
    border-bottom: 1px solid #555;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#player-list li:last-child {
    border-bottom: none;
}

/* --- Styles spécifiques du Jeu (Game Container) --- */
#film-image {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 6px 20px var(--shadow-medium);
    margin-bottom: 30px;
    border: 3px solid var(--primary-color); /* Cadre autour de l'image */
}

.timer-display {
    font-size: 1.8em;
    font-weight: bold;
    color: var(--secondary-color); /* Couleur accentuée pour le minuteur */
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.timer-display span {
    font-size: 1.2em; /* Pour le nombre du timer */
    margin-left: 8px;
    color: var(--light-text);
}

/* Styles pour le message de feedback (bonne/mauvaise réponse) */
#feedback-message {
    padding: 12px;
    border-radius: 8px;
    font-weight: bold;
    margin-bottom: 20px;

    /* Garder ces propriétés pour les transitions */
    opacity: 0; 
    transform: translateY(10px);
    transition: opacity 0.4s ease-out, transform 0.4s ease-out, background-color 0.3s ease, color 0.3s ease;
}

/* Nouvelle classe pour l'affichage avec transition */
#feedback-message.show {
    opacity: 1;
    transform: translateY(0);
}
/* Les couleurs ne sont plus gérées par des classes ici, mais par JS */

#feedback-message.correct {
    background-color: var(--success-color);
    color: white;
}

#feedback-message.incorrect {
    background-color: var(--error-color);
    color: white;
}


#next-film-button {
    background-color: var(--secondary-color); /* Couleur différente pour l'action de fin de film */
    color: var(--dark-bg);
}

#next-film-button:hover:not(:disabled) {
    background-color: #e0b44f; /* Assombrir au survol */
}

#skip-image-button {
    background-color: var(--error-color); /* Bouton rouge d'action rapide */
    color: white;
}

#skip-image-button:hover:not(:disabled) {
    background-color: #d32f2f; /* Assombrir au survol */
}


/* --- Styles pour l'affichage du titre du film révélé --- */
#film-reveal-message {
    background-color: var(--success-color);
    color: var(--light-text);
    font-size: 1.8em; /* Plus grand pour l'impact */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    margin-bottom: 30px;
    position: absolute; /* Pour le placer au-dessus des autres éléments */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2000; /* Assure qu'il est au-dessus de tout */
    width: 80%; /* Pour qu'il ne prenne pas toute la largeur */
    max-width: 500px;
    box-sizing: border-box;
}

#revealed-film-title {
    color: var(--light-text); /* Assure que le texte du titre est bien blanc */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* Petite ombre pour lisibilité */
}


/* --- Styles des scores finaux --- */
#final-results-container {
    text-align: center;
}

#final-scores-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    font-size: 1.2em;
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #4a4e58;
}

#final-scores-list li {
    padding: 10px 15px;
    border-bottom: 1px solid #555;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#final-scores-list li:last-child {
    border-bottom: none;
}

#final-scores-list li.winner {
    background-color: rgba(97, 218, 251, 0.2); /* Fond léger pour le gagnant */
    font-weight: bold;
    color: var(--primary-color);
}

/* --- Live Feedback Hôte --- */
#host-live-feedback {
    /* Styles inline déjà définis pour positionnement, mais tu peux ajouter ici pour l'esthétique */
    background-color: rgba(40, 44, 52, 0.9); /* Un peu plus sombre, plus transparent */
    border: 1px solid var(--primary-color);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

#host-live-feedback h3 {
    color: var(--secondary-color);
    font-size: 1.1em;
    margin-top: 0;
    border-bottom: 1px solid #555;
    padding-bottom: 10px;
}

#live-answers-list {
    font-size: 0.9em;
    color: var(--gray-text);
}

#live-answers-list li {
    margin-bottom: 5px;
    word-wrap: break-word; /* Casse les longs mots */
}

/* --- Intégration d'une police Google Fonts (à ajouter dans <head> de index.html) --- */
/*
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
*/
        
        
        
        
        
        
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #282c34;
            color: white;
            margin: 0;
            padding: 20px;
            box-sizing: border-box; /* Pour inclure le padding dans la largeur/hauteur */
        }

        

        #film-image {
    -webkit-user-drag: none; /* Safari, Chrome, Edge */
    -khtml-user-drag: none; /* Konqueror */
    -moz-user-drag: none; /* Firefox */
    -o-user-drag: none; /* Opera */
    pointer-events: none;
    
}



        
        #lobby-container, #game-container {
    /* Ces styles devraient rester les mêmes que ton code précédent */
    background-color: #383c44;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    width: 100%; /* Important pour que ça prenne toute la largeur disponible */
    max-width: 600px; /* Limite la largeur du conteneur principal */
    text-align: center;
    display: none;
}



        /* Styles pour afficher le lobby ou le jeu quand nécessaire */
        #lobby-container.active, #game-container.active {
            display: block;
        }

        h1, h2 {
            color: #61dafb;
        }

        #film-image {
            max-width: 90%; /* Ajusté pour mieux s'adapter */
            height: auto;
            margin-bottom: 20px;
            border: 2px solid #61dafb;
            border-radius: 5px;
        }

        input[type="text"] {
            padding: 10px;
            width: calc(100% - 130px); /* Ajusté pour le bouton */
            margin-right: 10px;
            border: none;
            border-radius: 5px;
            background-color: #444a52;
            color: white;
        }

        button {
            padding: 10px 20px;
            background-color: #61dafb;
            color: #282c34;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #4fa3d1;
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #player-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #61dafb;
            border-radius: 5px;
            background-color: #2e323a;
            text-align: left; /* Pseudos alignés à gauche */
        }

        #player-list li {
            padding: 8px 15px;
            border-bottom: 1px solid #383c44;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #player-list li:last-child {
            border-bottom: none;
        }

        #lobby-input-area {
            margin-bottom: 20px;
        }

        #start-game-button {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 1.2em;
        }

        .timer-display {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #FFD700; /* Or Jaune pour le minuteur */
        }

        #score-display {
            margin-bottom: 20px;
            border: 1px solid #61dafb;
            border-radius: 5px;
            padding: 10px;
            background-color: #2e323a;
        }
        #score-display h2 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #61dafb;
        }
        #score-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        #score-list li {
            padding: 5px 0;
            border-bottom: 1px dashed #444a52;
        }
        #score-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    
    
    <div id="lobby-container" class="active">
        <h1>Rejoins la partie !</h1>
        <div id="lobby-input-area">
            <input type="text" id="pseudo-input" placeholder="Choisis ton pseudo">
            <button id="join-lobby-button">Rejoindre</button>
        </div>
        <h2>Joueurs connectés :</h2>
        <ul id="player-list">
            </ul>
        <button id="start-game-button" style="display: none;">Lancer la partie</button>
    </div>

    <div id="game-container">
        <h1>D'ou vient cette image</h1>
        <img id="film-image" src="https://via.placeholder.com/400x250?text=Attente+Image" alt="Image du film" oncontextmenu="return false;" draggable="false">
        <p id="points-display">Points: --</p> <p class="timer-display">Minuteur: <span id="timer">30</span>s</p>

         <div id="feedback-message" style="
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            display: none; /* Caché par défaut */
        "></div>
       
    <div id="film-reveal-message" style="
        display: none; /* Caché par défaut */
        margin-top: 20px;
        padding: 15px;
        background-color: #4CAF50; /* Couleur verte pour "correct" */
        color: white;
        font-size: 1.5em;
        font-weight: bold;
        border-radius: 8px;
        text-align: center;
        opacity: 0; /* Pour l'animation de fondu */
        transition: opacity 0.5s ease-in-out; /* Transition pour l'opacité */
    ">
        Réponse : <span id="revealed-film-title"></span>
    </div>   
       
       
      
       
        <input type="text" id="answer-input" placeholder="Tape ta réponse ici">
        <button id="submit-button">Envoyer</button>
        <button id="next-film-button" style="display: none; margin-top: 20px; background-color: var(--secondary-color); color: var(--dark-bg);">Passer au film suivant</button>
        <button id="skip-image-button" style="display: none; margin-top: 20px; background-color: #f44336; color: white;">Passer l'image</button>
    </div>



    <div id="host-live-feedback" style="
        display: none; /* Caché par défaut */
        position: fixed; /* Position fixe pour qu'il ne bouge pas en scrollant */
        bottom: 20px; /* 20px du bas de la fenêtre */
        right: 20px; /* 20px de la droite de la fenêtre */
        width: 300px; /* Largeur du panneau */
        max-height: 40vh; /* Hauteur maximale pour éviter qu'il ne soit trop grand */
        background-color: rgba(56, 60, 68, 0.9); /* Fond semi-transparent */
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        padding: 15px;
        color: white;
        z-index: 1000; /* Assure qu'il est au-dessus des autres éléments */
        overflow-y: auto; /* Ajoute une barre de défilement si le contenu dépasse */
        border: 1px solid #61dafb;
    ">
        <h3>Réponses en direct (Hôte seulement)</h3>
        <ul id="live-answers-list" style="list-style: none; padding: 0; margin: 0;">
            </ul>
    </div>


    
    <audio id="soundCorrect" src="/sounds/correct_answer.wav" preload="auto" volume="0.4"></audio>
    <audio id="soundWrong" src="/sounds/wrong_answer.mp3" preload="auto" volume="0.4"></audio>
    <div id="lobby-container" class="active">
    
    <script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    // ====================================================================
    // --- Éléments du DOM (mis à jour avec tes IDs) ---
    // ====================================================================
    const lobbyContainer = document.getElementById('lobby-container');
    const gameContainer = document.getElementById('game-container');
    const finalResultsContainer = document.getElementById('final-results-container');
    const pseudoInput = document.getElementById('pseudo-input');
    const setPseudoButton = document.getElementById('join-lobby-button'); // Correspond à ton ID HTML
    const playerListUl = document.getElementById('player-list');
    const startGameButton = document.getElementById('start-game-button');
    
    const filmImage = document.getElementById('film-image');
    const timerDisplay = document.getElementById('timer'); // Ton span ID est 'timer'
    const pointsDisplay = document.getElementById('points-display'); // L'élément que tu dois ajouter
    const answerInput = document.getElementById('answer-input');
    const submitButton = document.getElementById('submit-button');
    const gameMessages = document.getElementById('feedback-message'); // Ton ID HTML pour les messages de feedback
    const scoreListUl = document.getElementById('score-list'); // Pour la liste des scores en jeu

    const filmRevealMessage = document.getElementById('film-reveal-message');
    const revealedFilmTitle = document.getElementById('revealed-film-title'); // Ton span ID
    const nextFilmButton = document.getElementById('next-film-button');
    const skipImageButton = document.getElementById('skip-image-button');

    const gameOverScreen = document.getElementById('final-results-container'); // Réutilise ton conteneur existant
    const finalScoresList = document.getElementById('final-score-list'); // Ton ID HTML pour la liste des scores finaux
    const restartGameButton = document.getElementById('restart-game-button');

    const hostLiveFeedback = document.getElementById('host-live-feedback');
    const liveAnswersDisplay = document.getElementById('live-answers-list'); // Ton ID HTML pour la liste des réponses

    // Audio elements
    const soundCorrect = document.getElementById('soundCorrect');
    const soundWrong = document.getElementById('soundWrong');

    // ====================================================================
    // --- Variables d'état du client ---
    // ====================================================================
    let isHost = false;
    let hasFoundFilmThisRound = false;
    let currentTimerClient = 0;
    let timerIntervalClient;

    // ====================================================================
    // --- Fonctions utilitaires d'affichage de l'interface ---
    // ====================================================================
    function showLobby() {
        lobbyContainer.style.display = 'block';
        gameContainer.style.display = 'none';
        filmRevealMessage.style.display = 'none';
        gameOverScreen.style.display = 'none';
        startGameButton.style.display = 'none';
        nextFilmButton.style.display = 'none';
        skipImageButton.style.display = 'none';
        restartGameButton.style.display = 'none';
        hostLiveFeedback.style.display = 'none';
        gameMessages.style.display = 'none'; // Cache les messages
        gameMessages.textContent = '';
        answerInput.disabled = false; // Réactive au retour au lobby
        submitButton.disabled = false;
        pseudoInput.disabled = false;
        setPseudoButton.disabled = false;
        // Réinitialise l'input du pseudo pour une nouvelle connexion
        pseudoInput.value = '';
        document.getElementById('lobby-input-area').innerHTML = `
            <input type="text" id="pseudo-input" placeholder="Choisis ton pseudo">
            <button id="join-lobby-button">Rejoindre</button>
        `;
        // Ré-attache l'écouteur pour le bouton de pseudo
        document.getElementById('join-lobby-button').addEventListener('click', handleSetPseudo);
        pseudoInput.addEventListener('keypress', handlePseudoKeyPress);
    }

   function showGame() {
    lobbyContainer.style.display = 'none';
    gameContainer.style.display = 'block';
    filmRevealMessage.style.display = 'none';
    gameOverScreen.style.display = 'none';
    gameMessages.style.display = 'none';

    // Assurez-vous que l'image est affichée mais transparente initialement
    filmImage.style.display = 'block'; // <--- Assurez-vous que cette ligne est bien là
    filmImage.style.opacity = '0'; // L'opacité sera gérée par 'display image'

    // Cacher les boutons de réponse et de film suivant au démarrage du jeu
    answerInput.style.display = 'inline-block'; // Afficher l'input de réponse
    submitButton.style.display = 'inline-block'; // Afficher le bouton soumettre
    nextFilmButton.style.display = 'none'; // Cacher le bouton 'Film Suivant'
    skipImageButton.style.display = 'inline-block'; // Afficher le bouton 'Passer image' (si nécessaire)
}

    function showFilmReveal(title) {
        gameContainer.style.display = 'none'; // Cache l'interface de jeu principale
        filmRevealMessage.style.display = 'block';
        revealedFilmTitle.textContent = title;
        setTimeout(() => { filmRevealMessage.style.opacity = 1; }, 50);
        answerInput.disabled = true;
        submitButton.disabled = true;
        skipImageButton.style.display = 'none';
        clearInterval(timerIntervalClient); // Arrête le minuteur
        timerDisplay.textContent = '0'; // Affiche 0
    }

    function showGameOver(finalScores) {
        gameContainer.style.display = 'none';
        filmRevealMessage.style.display = 'none';
        gameOverScreen.style.display = 'block'; // Utilise ton conteneur existant
        hostLiveFeedback.style.display = 'none'; // Masquer pour la fin du jeu
        skipImageButton.style.display = 'none';
        nextFilmButton.style.display = 'none'; // Ne pas montrer en fin de partie

        finalScoresList.innerHTML = ''; // Nettoie la liste
        if (finalScores && finalScores.length > 0) {
            // Trie les scores pour afficher le gagnant en premier
            const sortedScores = finalScores.sort((a, b) => b.score - a.score);
            sortedScores.forEach((player, index) => {
                const li = document.createElement('li');
                li.textContent = `${index + 1}. ${player.pseudo}: ${player.score} points`;
                if (index === 0) { // Si c'est le premier (le gagnant)
                    li.classList.add('winner'); // Tu peux ajouter un style CSS pour cette classe
                }
                finalScoresList.appendChild(li);
            });
        } else {
            const li = document.createElement('li');
            li.textContent = "Aucun score disponible.";
            finalScoresList.appendChild(li);
        }

        if (isHost) {
            restartGameButton.style.display = 'block';
        }
    }

    function displayGameMessage(message, type = 'info') {
        gameMessages.textContent = message;
        gameMessages.style.display = 'block'; // Assure que le message est visible
        gameMessages.classList.remove('correct', 'incorrect'); // Nettoie les classes précédentes

        // Applique la couleur appropriée
        if (type === 'success') {
            gameMessages.style.backgroundColor = '#4CAF50';
            gameMessages.style.color = 'white';
            gameMessages.classList.add('correct');
        } else if (type === 'error') {
            gameMessages.style.backgroundColor = '#f44336';
            gameMessages.style.color = 'white';
            gameMessages.classList.add('incorrect');
        } else { // info ou autre
            gameMessages.style.backgroundColor = 'transparent'; // Pour ne pas masquer le fond
            gameMessages.style.color = 'white';
        }

        // Ajoute la classe 'show' pour la transition CSS si tu en as une
        setTimeout(() => {
            gameMessages.classList.add('show');
        }, 10); // Petit délai pour que la transition s'active

        // Masque le message après un délai
        setTimeout(() => {
            gameMessages.classList.remove('show');
            setTimeout(() => {
                gameMessages.style.display = 'none';
                gameMessages.textContent = '';
            }, 400); // Correspond à la durée de la transition de masquage
        }, 2000); // Afficher pendant 2 secondes
    }

    // Fonction utilitaire pour jouer un son
    function playSound(audioElement) {
        if (audioElement) {
            audioElement.currentTime = 0; // Rembobine le son au début
            const playPromise = audioElement.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => { /* Lecture réussie */ })
                .catch(error => { console.warn("La lecture audio a été bloquée :", error); });
            }
        }
    }

    // Empêche le clic droit sur toute la page
    document.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        console.log("Le clic droit est désactivé sur cette page pour des raisons de jeu anti-triche.");
    });
    filmImage.addEventListener('contextmenu', (e) => { e.preventDefault(); });

    // ====================================================================
    // --- Gestion des événements Socket.IO ---
    // ====================================================================

    // Initialisation
    document.addEventListener('DOMContentLoaded', showLobby); // Afficher le lobby au chargement

    socket.on('connect', () => {
        console.log('Connecté au serveur Socket.IO');
    });

    socket.on('host connected', () => {
        isHost = true;
        console.log("Vous êtes l'hôte.");
        startGameButton.style.display = 'block';
    });

    socket.on('pseudo accepted', () => {
        displayGameMessage('Pseudo accepté ! En attente du début de partie...', 'success');
        pseudoInput.disabled = true;
        setPseudoButton.disabled = true;
        document.getElementById('lobby-input-area').innerHTML = `<p>Bienvenue, ${pseudoInput.value.trim()} ! En attente des autres joueurs...</p>`;
    });

    socket.on('pseudo taken', (message) => {
        displayGameMessage(message, 'error');
        pseudoInput.value = '';
    });

    socket.on('update player list', (players) => {
        playerListUl.innerHTML = '';
        players.forEach(pseudo => {
            const li = document.createElement('li');
            li.textContent = pseudo;
            playerListUl.appendChild(li);
        });
    });

    socket.on('update scores', (scores) => {
        scoreListUl.innerHTML = '';
        scores.forEach(player => {
            const li = document.createElement('li');
            li.textContent = `${player.pseudo}: ${player.score}`;
            scoreListUl.appendChild(li);
        });
    });

    socket.on('game started', () => {
        displayGameMessage('La partie a commencé !', 'info');
        showGame();
        hasFoundFilmThisRound = false;
        liveAnswersDisplay.innerHTML = ''; // Nettoie les réponses live au début d'une nouvelle partie
    });

    socket.on('display image', (data) => {
    console.log(`Réception de l'image : ${data.url}, Temps : ${data.initialTime}, Points : ${data.points}`);
    // Assurez-vous que l'image est visible (mais transparente au début de la transition)
    filmImage.style.display = 'block'; // <--- Ajoutez ou assurez-vous de cette ligne ici
    filmImage.style.opacity = '0'; // Cache l'image pendant le changement

    filmImage.src = data.url; // Met à jour la source de l'image
    timerDisplay.textContent = `Temps restant : ${data.initialTime}s`;
    pointsDisplay.textContent = `Points par bonne réponse : ${data.points}`;
    feedbackMessage.textContent = ''; // Efface les messages précédents

    // Réinitialiser les boutons après un changement d'image
    answerInput.style.display = 'inline-block'; // Afficher l'input de réponse
    submitButton.style.display = 'inline-block'; // Afficher le bouton soumettre
    nextFilmButton.style.display = 'none'; // Cacher le bouton 'Film Suivant'
    skipImageButton.style.display = 'inline-block'; // Afficher le bouton 'Passer image' (si nécessaire)

    // Animation de fondu :
    // Un petit délai pour s'assurer que le navigateur a mis à jour le src
    // avant de démarrer la transition d'opacité.
    setTimeout(() => {
        filmImage.style.opacity = '1'; // Rend l'image visible
    }, 50); // Petite latence pour l'opacité
});

    socket.on('timer update', (timeLeft) => {
        timerDisplay.textContent = `${timeLeft}`;
        currentTimerClient = timeLeft;
    });

    socket.on('timer expired', () => {
        clearInterval(timerIntervalClient);
        timerDisplay.textContent = "Temps écoulé !";
        answerInput.disabled = true;
        submitButton.disabled = true;
        displayGameMessage('Temps écoulé !', 'info');
    });

    socket.on('answer result', (data) => {
        displayGameMessage(data.message, data.correct ? 'success' : 'error');
        if (data.correct) {
            playSound(soundCorrect);
            answerInput.disabled = true;
            submitButton.disabled = true;
            hasFoundFilmThisRound = true;
        } else {
            playSound(soundWrong);
            // Si la réponse est fausse, on désactive l'input pour cette manche (une seule tentative)
            answerInput.disabled = true;
            submitButton.disabled = true;
        }
    });
    
    socket.on('live answer', (data) => {
        if (isHost) {
            const li = document.createElement('li');
            li.textContent = `${data.pseudo}: ${data.answer}`;
            liveAnswersDisplay.prepend(li);
            // Limiter la taille de la liste des réponses en direct
            const maxMessages = 10;
            while (liveAnswersDisplay.children.length > maxMessages) {
                liveAnswersDisplay.removeChild(liveAnswersDisplay.lastChild);
            }
            hostLiveFeedback.style.display = 'block'; // S'assurer que c'est visible
        }
    });

    socket.on('reveal film', (data) => {
    console.log(`Le film était : ${data.revealedTitle}`);
    console.log(`Scores des joueurs :`, data.scores);
    filmImage.style.opacity = '0'; // Cache l'image
    // Après un court délai, cacher l'image complètement et afficher le message
    setTimeout(() => {
        filmImage.style.display = 'none'; // Cache l'image complètement
        revealedFilmTitle.textContent = data.revealedTitle; // Affiche le titre
        filmRevealMessage.style.opacity = '1';
        filmRevealMessage.style.display = 'block'; // Affiche le message de révélation
        // Masquer les boutons de réponse et le champ de texte
        answerInput.style.display = 'none';
        submitButton.style.display = 'none';
        skipImageButton.style.display = 'none'; // Cacher le bouton 'Passer image'

        // Afficher le bouton "Film suivant" seulement pour l'hôte après révélation
        if (isHost) {
            nextFilmButton.style.display = 'block';
        }
    }, 500); // Délai avant de cacher l'image et d'afficher le message de révélation
    // ...
});

    socket.on('game over', (finalScores) => {
        showGameOver(finalScores);
    });

    socket.on('return to lobby', () => {
        showLobby();
        console.log("Retour au lobby.");
    });

    // ====================================================================
    // --- Gestion des clics sur les boutons ---
    // ====================================================================

    function handleSetPseudo() {
        const pseudo = pseudoInput.value.trim();
        if (pseudo) {
            socket.emit('set pseudo', pseudo);
        } else {
            displayGameMessage('Veuillez entrer un pseudo valide.', 'error');
        }
    }
    setPseudoButton.addEventListener('click', handleSetPseudo);

    function handleSubmitAnswer() {
        const answer = answerInput.value.trim();
        if (answer && !answerInput.disabled) {
            socket.emit('submit answer', answer);
        } else {
            displayGameMessage("Veuillez taper une réponse !", 'info');
        }
    }
    submitButton.addEventListener('click', handleSubmitAnswer);

    startGameButton.addEventListener('click', () => {
        if (isHost) {
            socket.emit('start game');
        }
    });

    nextFilmButton.addEventListener('click', () => {
        if (isHost) {
            socket.emit('request next film');
            nextFilmButton.style.display = 'none';
            answerInput.style.display = 'inline-block'; // Réafficher l'input et le bouton
            submitButton.style.display = 'inline-block';
        }
    });

    skipImageButton.addEventListener('click', () => {
        if (isHost) {
            socket.emit('skip current image');
            skipImageButton.style.display = 'none'; // Cache le bouton après l'action
        }
    });

    restartGameButton.addEventListener('click', () => {
        if (isHost) {
            socket.emit('host restart game');
            gameOverScreen.style.display = 'none'; // Cache l'écran des résultats
            // Le serveur va renvoyer au lobby
        }
    });

    // Gérer l'envoi de pseudo avec la touche Entrée
    function handlePseudoKeyPress(e) {
        if (e.key === 'Enter') {
            setPseudoButton.click();
        }
    }
    pseudoInput.addEventListener('keypress', handlePseudoKeyPress);

    // Gérer l'envoi de réponse avec la touche Entrée
    answerInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !answerInput.disabled) {
            submitButton.click();
        }
    });

</script>
</body>
</html>